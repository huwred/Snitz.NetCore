@model MVCForum.Models.PagingModel
@{
    int pagecount = ViewBag.PageCount;
    var page = Model.Page;
    var orderby = "";
    var defaultdays = "";
    var sortdir = "";

    if (Context.Request.Query["page"].Count > 0)
    {
        page = Convert.ToInt32(Context.Request.Query["page"].ToString());
    }
    var intLow = page - 1;
    var intHigh = page + 3;
    if (page == 1) {intLow = 1;}
    if (intHigh > pagecount) {intHigh = pagecount;}
    if (intHigh - intLow < 5) {while ((intHigh < intLow + 4) && intHigh < pagecount) {intHigh++;}}
    if (intHigh - intLow < 5) {while ((intLow > intHigh - 4) && intLow > 1) {intLow--;}}

    if (Context.Request.Query["orderby"].Count > 0)
    {
        orderby = $"&orderby={Context.Request.Query["orderby"]}";
    }
    else if (Model.OrderBy != null)
    {
        orderby = $"&orderby={Model.OrderBy}";
    }
    
    if (Context.Request.Query["defaultdays"].Count > 0)
    {
        defaultdays = $"&defaultdays={Context.Request.Query["defaultdays"]}";
    }
    else if (Model.DefaultDays != -10000)
    {
        defaultdays = $"&defaultdays={Model.DefaultDays}";
    }
    
    if (Context.Request.Query["sortdir"].Count > 0)
    {
        sortdir = $"&sortdir={Context.Request.Query["sortdir"]}";
    }
    else if (Model.SortDir != null)
    {
        sortdir = $"&sortdir={Model.SortDir}";
    }
}
<nav aria-label="Page navigation" class="mb-1">
    <ul class="pagination">
        @if (page == 1)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="First" tabindex="-1">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">First</span>
                </a>
            </li>
            <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="Previous" tabindex="-1">
                    <span aria-hidden="true">&lsaquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
        }
        else
        {
            <li class="page-item">
                <a class="page-link" href="?page=1@(orderby)@(defaultdays)@(sortdir)" aria-label="First" tabindex="-1">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">First</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page=@(page-1)@(orderby)@(defaultdays)@(sortdir)" aria-label="Previous">
                    <span aria-hidden="true">&lsaquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
        }
        @for (int i = intLow; i < intHigh + 1; i++)
        {
            if (i == page)
            {
                <li class="page-item active"><a class="page-link" href="?page=@i@(orderby)@(defaultdays)@(sortdir)">@i<span class="sr-only">(current)</span></a></li>
            }
            else
            {
                <li class="page-item"><a class="page-link" href="?page=@i@(orderby)@(defaultdays)@(sortdir)">@i</a></li>
            }
            
        }
        @if (page == pagecount)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="Next" tabindex="-1">
                    <span aria-hidden="true">&rsaquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
            <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="Last" tabindex="-1">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Last</span>
                </a>
            </li>
        }
        else
        {
            <li class="page-item">
                <a class="page-link" href="?page=@(page+1)@(orderby)@(defaultdays)@(sortdir)" aria-label="Next">
                    <span aria-hidden="true">&rsaquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page=@pagecount@(orderby)@(defaultdays)@(sortdir)" aria-label="Last">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Last</span>
                </a>
            </li>
        }
        <span>@pagecount pages</span>
    </ul>
</nav>