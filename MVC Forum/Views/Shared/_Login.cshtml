@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using SnitzCore.Data.Extensions
@using SnitzCore.Data.Models
@model MVCForum.Models.User.UserSignInModel
@inject SignInManager<ForumUser> SignInManager
@if (!SignInManager.IsSignedIn(User))
{
    var returnurl = Context.Request.HttpContext.Request.Path;
    if (returnurl.ToString().Contains("Login"))
    {
        string referer = Context.Request.Headers["Referer"].ToString();
        if (!string.IsNullOrWhiteSpace(referer) && ! referer.Contains("Account"))
        {
            Uri baseUri = new Uri(referer);
            returnurl = baseUri.AbsolutePath;
        }
        else
        {
            returnurl = Context.Request.Query["ReturnUrl"].ToString();
        }

    }
    <div class="m-2 bg-form border border-dark rounded">
        <div class="subforum ">
            <h1 class="bg-dark text-white p-2">SignIn</h1>
            @Html.MyValidationSummary(false,"",new{@class="list-unstyled p-2"})

            <form method="post" asp-controller="Account" asp-action="Login" class="needs-validation p-2" novalidate>
                <div class="form-group">
                    <label asp-for="Username"></label>
                    <input asp-for="Username" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="Password"></label>
                    <div class="input-group" id="show_hide_password">
                        @Html.PasswordFor(m => m.Password,new{@class="form-control"})
                    </div>
                </div>
                <div class="form-group">
                    <label asp-for="RememberMe"></label>
                    @Html.CheckBoxFor(m=>m.RememberMe,new{@class="checkbox"})
                </div>
                <input name="ReturnUrl" value="@returnurl" type="hidden"/>
                <button type="submit" class="btn btn-primary">Log in</button>
                <div class="form-group">
                    <a asp-action="ForgotPassword" asp-controller="Account">Forgot Password</a>
                </div>
            </form>
        </div>
    </div>
}

