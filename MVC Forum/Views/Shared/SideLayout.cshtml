@using System.Globalization
@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using SnitzCore.Service.MiddleWare
@using SnitzCore.Service.TagHelpers
@{
    string[] rtlLangs = new string[] { "ar", "arc", "dv", "fa", "ha", "khw", "ks", "ku", "ps", "ur", "yi", "he" };

    //check the culture so we can set the page direction and language
    var cookielang = SnitzCookie.GetCookieValue("CookieLang");
    CultureInfo ci = CultureInfo.CurrentUICulture;
    string clang = ci.TwoLetterISOLanguageName;

    if (cookielang != null)
    {
        var cultureInfo = new CultureInfo(cookielang);
        CultureInfo.CurrentUICulture = cultureInfo;
        clang = cultureInfo.TwoLetterISOLanguageName;
    }
    Context.Session.SetString("culture", clang);
    bool isRighToLeft = rtlLangs.Contains(clang);
    MemberService.SetLastHere(User);
}
<!DOCTYPE html>
<html lang="@clang" dir="@(isRighToLeft ?  "rtl" : "ltr" )">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="@Config.Value.strForumUrl?.TrimEnd('/')/favicon.ico">
    @await RenderSectionAsync("MetaData", required: false)
    @if (isRighToLeft)
    {
        <link rel="stylesheet" href="~/css/bootstrap.rtl.min.css">

    }else{
        <link rel="stylesheet" href="~/css/bootstrap.min.css" />

    }
    
    <link rel="stylesheet" href="~/lib/font-awesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="~/lib/font-awesome/css/regular.min.css">
    <link rel="stylesheet" href="~/lib/font-awesome/css/solid.min.css">
    <environment include="Development">
        <link rel="stylesheet" href="~/css/site.css">
        <link rel="stylesheet" href="~/css/about.css">
        <link rel="stylesheet" href="~/css/busy.css">
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="~/css/site.min.css" />
        <link rel="stylesheet" href="~/css/about.min.css">
        <link rel="stylesheet" href="~/css/busy.min.css">
    </environment>
    <link rel="stylesheet" href="~/css/site-sidebar.min.css" />
    @await Component.InvokeAsync("SnitzThemeCss")
    @await RenderSectionAsync("Styles", required: false)

</head>
<body>

  <!-- Fixed Header -->
<nav id="fixed-head" class="navbar navbar-dark bg-dark fixed-top">
    <div class="container justify-content-between">
        <button title="Sidebar" class="btn btn-outline-secondary sidebar-toggle text-white fs-2 mx-4 border-0" id="toggleSidebar">☰</button>
        <span class="navbar-brand"><partial name="MenuLogo" /></span>
        <partial name="SelectTheme" />
        <partial name="mailbox" />
        <partial name="SelectLanguage" />
        @if (User.IsInRole("Administrator"))
        {
            <div id="admin-menu"><partial name="AdminMenu" /></div>       
        }
    </div>
</nav>
<div class="container content" >

  <!-- Sidebar -->
  <div id="sidebar" class="border-end">
    <partial name="SideNav" />
  </div>

  <!-- Main Content -->
    <div id="main-content" class="p-4">
        <partial snitz-if="@(SnitzConfig.IsEnabled("INTDONATIONS"))" name="PaypalBanner" />
        @if (SnitzConfig.IsEnabled("INTTOPBANNER"))
        {
            @await Component.InvokeAsync("AdRotator", new { template = "top" })
        }
        <div id="liveAlertPlaceholder"></div>     
        <partial snitz-if="@(SnitzConfig.IsEnabled("STRSHOWANNOUNCE"))" name="Announcement" />

        @RenderBody()
        <partial snitz-if="@(SnitzConfig.IsEnabled("INTREQUIRECONSENT"))" name="CookieConsentPartial" />
    </div>
</div>
  <!-- Sticky Footer -->
    <partial name="Footer"/>

    <div id="user-card" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body user-card">
                    <div class="card-content" id="user-card-content" data-name="popover">
                        some stuff <b>bold</b>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="~/js/jquery.min.js" ></script>
    <script type="text/javascript" src="~/js/bootstrap.bundle.min.js" ></script>
    <script type="text/javascript" src="~/js/jquery.unobtrusive-ajax.min.js" ></script>
    <script type="text/javascript" src="~/lib/jquery/dist/jquery-ui.min.js"></script>
    <environment include="Development">
        <partial name="GlobalJs" />
        @if (SnitzConfig.IsEnabled("INTUSETIMEAGO"))
        {
            <script type="text/javascript" src="~/lib/jquery/jquery.timeago.min.js" ></script>         
        }
        <script type="text/javascript" src="~/js/jquery.cookie.js" ></script>
        <partial name="ValidationScriptsPartial" />
        <script type="text/javascript" src="~/js/site.js" asp-append-version="true" ></script>
    </environment>
    <environment exclude="Development">
        @if (SnitzConfig.IsEnabled("INTUSETIMEAGO"))
        {
            <script type="text/javascript" src="~/lib/jquery/jquery.timeago.min.js" ></script>         
        }
        <script type="text/javascript" src="~/js/jquery.cookie.min.js"></script>
        <partial name="GlobalJs" />
        <partial name="ValidationScriptsPartial" />
        <script type="text/javascript" src="~/js/site.min.js" asp-append-version="true"></script>
    </environment>
    @if (!clang.Contains("en") && SnitzConfig.IsEnabled("INTUSETIMEAGO"))
    {
            var src = $"timeago.{clang}.js";
            <script type="text/javascript" src="~/js/timeago/@src"></script>
    }
    @await RenderSectionAsync("Scripts", required: false)
    <renderstoredcontent asp-key="cookie-consent"></renderstoredcontent>
    <renderstoredcontent asp-key="password-toggle"></renderstoredcontent>
    @if (SnitzConfig.IsEnabled("INTDONATIONS"))
    {
        <script type="text/javascript" src="~/js/paypalbanner.min.js"></script>
    }
    <script type="text/javascript">
        $(document).ready(function () {
            // Sidebar toggle behavior
            let sidebarCollapse = localStorage.getItem('sidebarCollapse');
            if (sidebarCollapse) {

                document.getElementById('sidebar').classList.toggle('collapsed');
            }
        });
    </script>
</body>
</html>
