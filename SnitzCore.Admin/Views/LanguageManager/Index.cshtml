@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.Extensions.Options
@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Localization
@model SnitzCore.BackOffice.ViewModels.TranslationViewModel
@inject IOptions<RequestLocalizationOptions> LocOptions
@{
    ViewBag.Title = "Translation Manager";
    Layout = "_MasterLayout";
    var cultureItems = LocOptions.Value.SupportedUICultures!
        .Select(c => new SelectListItem { Value = c.TwoLetterISOLanguageName, Text = c.DisplayName })
        .ToList();
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    string clang = requestCulture?.RequestCulture.Culture.Name!;
}
<div class="mt-3">
    @*     <legend>@ViewBag.Title</legend>
    <hr /> *@
    <form asp-action="Search" asp-controller="LanguageManager" method="POST" class="mt-3" style="display: none;">
        <div class="input-group mb-3">
            <input name="filter" class="form-control" id="filter" />
            <button type="submit" class="btn btn-primary">Find</button>
        </div>
    </form>
    <form asp-action="AddResource" data-ajax="true" data-ajax-update="#result-resource" class="row mt-3">
        <legend>Add new Resource Key</legend>
        <div class="col-2 mb-3">
            <label for="ResourceSet" class="form-label">Resource Set</label>
            <select id="ResourceSet" class="form-select" title="Select language to edit" name="ResourceSet" aria-required="true">
                <option value="" selected>- Select -</option>
                @foreach (var rs in Model.ResourceSets)
                {
                    <option value="@rs">@rs</option>
                }
            </select>
            <div class="valid-feedback"></div>
        </div>
        <div class="col-3 mb-3">
            <label for="Name" class="form-label">Resource Key</label>
            <input type="text" class="form-control" id="Name" name="Name" aria-required="true">
            <div class="valid-feedback"></div>
        </div>
        <div class="col-4 mb-3">
            <label for="ResourseValue" class="form-label">Value</label>
            <input type="text" class="form-control" id="ResourseValue" name="Value">
        </div>
        <div class="col-2 mb-3">
            <label for="ResourceLang" class="form-label">Language</label>
            <select id="ResourceLang" class="form-select" title="Select language to edit" name="Culture">
                <option value="" selected>- Select -</option>
                @foreach (var culture in cultureItems)
                {
                    if (culture.Value == clang)
                    {
                        <option value="@culture.Value" selected>@culture.Text</option>
                    }
                    else
                    {
                        <option value="@culture.Value">@culture.Text</option>
                    }
                }
            </select>
        </div>
        <div class="col-1 mb-3"><button type="submit" class="btn btn-danger mt-4"><i class="fa fa-save"></i></button></div>
    </form>
    <div id="result-resource"></div>
    <hr/>
    <div class="row">
        <ul class="list-unstyled col-2">
            <li class="fw-bold">Resource Sets</li>
            <li><hr/></li>
            @foreach (var lang in Model.Resources.GroupBy(l => l.ResourceSet).OrderBy(o=>o.Key))
            {
                <li data-id="@lang.Key" class="resource-set" style="cursor: pointer">@lang.Key</li>
            }
        </ul>
        <div class="col">
            <div id="loader"></div>
            <div class="card " id="resource-card"></div>
        </div>
    </div>
</div>

@section Scripts
{
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery.unobtrusive-ajax.js"></script>
    <script type="text/javascript">
        var $loading = $('#loader').hide();
        $(document)
            .ajaxStart(function () {
                $loading.show();
            })
            .ajaxStop(function () {
                $loading.hide();
            });

        $(document).ready(function() {
            $('#resource-card').load("/LanguageManager/ResourceSet/Admin/?filter=" + $('#filter').val());
        });
        $(document).on("click", ".resource-set",
            function() {
                $('#resource-card')
                    .load("/LanguageManager/ResourceSet/" + $(this).data('id') + "/?filter=" + $('#filter').val());
            });
        $(document).on("change",
            "#select-lang",
            function(e) {
                var lang = $(this).val();
                $("div[class^='lang_']").hide();
                $("." + lang).show();
            });
    </script>
}